<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RHCSA Practice Lab with Root Access</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Courier New', monospace; }
        body { background: #1e1e1e; color: #f0f0f0; height: 100vh; display: flex; flex-direction: column; }
        .header { background: #2d2d2d; padding: 15px; border-bottom: 2px solid #4CAF50; display: flex; justify-content: space-between; }
        .header h1 { color: #4CAF50; }
        .controls { display: flex; gap: 10px; }
        .control-btn { background: #444; border: none; color: white; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
        .control-btn:hover { background: #555; }
        .container { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 300px; background: #252526; padding: 15px; overflow-y: auto; }
        .scenario-list { list-style: none; }
        .scenario-item { padding: 12px; margin: 5px 0; background: #2d2d2d; border-radius: 4px; cursor: pointer; border-left: 4px solid transparent; }
        .scenario-item:hover { background: #3d3d3d; }
        .scenario-item.active { background: #0d5c0d; border-left-color: #4CAF50; }
        .terminal-container { flex: 1; padding: 15px; display: flex; flex-direction: column; }
        .terminal { background: #000; border: 1px solid #444; border-radius: 8px; flex: 1; padding: 15px; display: flex; flex-direction: column; }
        .output { flex: 1; overflow-y: auto; margin-bottom: 10px; }
        .input-line { display: flex; align-items: center; background: #111; padding: 8px; border-radius: 4px; }
        .prompt { color: #4CAF50; margin-right: 8px; font-weight: bold; }
        .prompt.root { color: #ff6b6b; }
        .command-input { background: transparent; border: none; color: white; flex: 1; outline: none; font-size: 16px; }
        .response { margin: 5px 0; white-space: pre-wrap; }
        .error { color: #ff6b6b; }
        .success { color: #4CAF50; }
        .info { color: #64b5f6; }
        .warning { color: #ff9800; }
        .directory { color: #64b5f6; }
        .file { color: white; }
        .user { color: #ffeb3b; }
        .root-indicator { background: #ff6b6b; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.8rem; margin-left: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>RHCSA Practice Sessions</h1>
        <div class="controls">
            <button class="control-btn" id="clear-btn">Clear</button>
            <button class="control-btn" id="help-btn">Help</button>
            <button class="control-btn" id="reset-btn">Reset</button>
        </div>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <h2>RHCSA Exam Topics</h2>
            <ul class="scenario-list">
                <li class="scenario-item active" data-scenario="files">File Management</li>
                <li class="scenario-item" data-scenario="perms">Permissions</li>
                <li class="scenario-item" data-scenario="users">User Management</li>
                <li class="scenario-item" data-scenario="storage">Storage</li>
                <li class="scenario-item" data-scenario="services">Services</li>
                <li class="scenario-item" data-scenario="processes">Processes</li>
                <li class="scenario-item" data-scenario="root">Root Access Practice</li>
            </ul>
            <div style="margin-top: 20px; font-size: 0.9rem; color: #aaa;">
                <p><strong>Root Access:</strong></p>
                <p>Use: <code>su -</code> or <code>sudo command</code></p>
                <p>Root password: <code>redhat</code></p>
                <p>TAB completion works for commands and files</p>
            </div>
        </div>
        
        <div class="terminal-container">
            <div class="terminal">
                <div class="output" id="output">
                    <div class="response info">Welcome to RHCSA Practice Lab with Root Access!</div>
                    <div class="response info">Type commands to practice. Use 'su -' to switch to root.</div>
                    <div class="response info">Root password: <span class="warning">redhat</span></div>
                    <div class="response info">Current directory: <span class="directory">/home/student</span></div>
                </div>
                <div class="input-line">
                    <span class="prompt" id="prompt">[student@rhcsa ~]$</span>
                    <input type="text" class="command-input" id="command-input" autofocus>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize variables
        const output = document.getElementById('output');
        const commandInput = document.getElementById('command-input');
        const promptElement = document.getElementById('prompt');
        const scenarioItems = document.querySelectorAll('.scenario-item');
        
        let currentDir = '/home/student';
        let currentUser = 'student';
        let commandHistory = [];
        let historyIndex = -1;
        let isRoot = false;
        let waitingForPassword = false;
        let sudoCommand = '';

        // All supported commands for autocomplete
        const allCommands = [
            'ls', 'cd', 'pwd', 'mkdir', 'rmdir', 'touch', 'rm', 'cp', 'mv',
            'cat', 'head', 'tail', 'less', 'more', 'echo', 'chmod', 'chown', 'chgrp',
            'lsblk', 'mount', 'umount', 'df', 'du', 'fdisk', 'parted', 'mkfs', 'fsck',
            'useradd', 'usermod', 'userdel', 'groupadd', 'groupmod', 'groupdel',
            'passwd', 'id', 'whoami', 'su', 'sudo', 'exit',
            'systemctl', 'service', 'chkconfig',
            'ps', 'kill', 'killall', 'pkill', 'top', 'htop', 'nice', 'renice',
            'grep', 'find', 'locate', 'which', 'whereis',
            'tar', 'gzip', 'gunzip', 'zip', 'unzip',
            'ssh', 'scp', 'ping', 'ifconfig', 'ip', 'netstat', 'ss', 'route',
            'firewall-cmd', 'getenforce', 'setenforce', 'sestatus', 'chcon', 'restorecon',
            'crontab', 'history', 'clear', 'help', 'man', 'whatis'
        ];

        // File system simulation
        const fileSystem = {
            '/': {
                type: 'directory',
                permissions: 'drwxr-xr-x',
                owner: 'root',
                group: 'root',
                children: {
                    'home': {
                        type: 'directory',
                        permissions: 'drwxr-xr-x',
                        owner: 'root',
                        group: 'root',
                        children: {
                            'student': {
                                type: 'directory',
                                permissions: 'drwxr-xr-x',
                                owner: 'student',
                                group: 'student',
                                children: {
                                    'Documents': { 
                                        type: 'directory', 
                                        permissions: 'drwxr-xr-x', 
                                        owner: 'student', 
                                        group: 'student', 
                                        children: {
                                            'rhcsa_notes.txt': {
                                                type: 'file',
                                                permissions: '-rw-r--r--',
                                                owner: 'student',
                                                group: 'student',
                                                content: 'RHCSA Exam Notes\n- Use su - to become root\n- Root password: redhat\n- Practice system administration tasks'
                                            }
                                        } 
                                    },
                                    'Downloads': { 
                                        type: 'directory', 
                                        permissions: 'drwxr-xr-x', 
                                        owner: 'student', 
                                        group: 'student', 
                                        children: {} 
                                    },
                                    'scripts': {
                                        type: 'directory',
                                        permissions: 'drwxr-xr-x',
                                        owner: 'student',
                                        group: 'student',
                                        children: {
                                            'backup.sh': {
                                                type: 'file',
                                                permissions: '-rwxr-xr-x',
                                                owner: 'student',
                                                group: 'student',
                                                content: '#!/bin/bash\necho "Backup script"'
                                            }
                                        }
                                    },
                                    'example.txt': { 
                                        type: 'file', 
                                        permissions: '-rw-r--r--', 
                                        owner: 'student', 
                                        group: 'student',
                                        content: 'This is an example file for RHCSA practice.'
                                    }
                                }
                            }
                        }
                    },
                    'etc': {
                        type: 'directory',
                        permissions: 'drwxr-xr-x',
                        owner: 'root',
                        group: 'root',
                        children: {
                            'passwd': {
                                type: 'file',
                                permissions: '-rw-r--r--',
                                owner: 'root',
                                group: 'root',
                                content: 'root:x:0:0:root:/root:/bin/bash\nstudent:x:1000:1000:Student User:/home/student:/bin/bash'
                            },
                            'shadow': {
                                type: 'file',
                                permissions: '-r--------',
                                owner: 'root',
                                group: 'root',
                                content: 'root:$6$redhat$encrypted:18659:0:99999:7:::\nstudent:$6$redhat$encrypted:18659:0:99999:7:::'
                            },
                            'sudoers': {
                                type: 'file',
                                permissions: '-r--r-----',
                                owner: 'root',
                                group: 'root',
                                content: '# User privilege specification\nroot    ALL=(ALL:ALL) ALL\n%wheel  ALL=(ALL:ALL) ALL\nstudent ALL=(ALL:ALL) ALL'
                            }
                        }
                    },
                    'root': {
                        type: 'directory',
                        permissions: 'drwx------',
                        owner: 'root',
                        group: 'root',
                        children: {
                            '.bashrc': {
                                type: 'file',
                                permissions: '-rw-r--r--',
                                owner: 'root',
                                group: 'root',
                                content: '# Root user bashrc\nPS1="[\\u@\\h \\W]# "\n'
                            },
                            'important_file.conf': {
                                type: 'file',
                                permissions: '-rw-------',
                                owner: 'root',
                                group: 'root',
                                content: 'Important system configuration file\nOnly root can read this file'
                            }
                        }
                    },
                    'var': {
                        type: 'directory',
                        permissions: 'drwxr-xr-x',
                        owner: 'root',
                        group: 'root',
                        children: {
                            'log': {
                                type: 'directory',
                                permissions: 'drwxr-xr-x',
                                owner: 'root',
                                group: 'root',
                                children: {
                                    'secure': {
                                        type: 'file',
                                        permissions: '-rw-------',
                                        owner: 'root',
                                        group: 'root',
                                        content: 'Security logs - root access only'
                                    }
                                }
                            }
                        }
                    }
                }
            }
        };

        // Update prompt based on current user
        function updatePrompt() {
            if (isRoot) {
                promptElement.textContent = `[root@rhcsa ${getCurrentDirName()}]#`;
                promptElement.className = 'prompt root';
            } else {
                promptElement.textContent = `[student@rhcsa ${getCurrentDirName()}]$`;
                promptElement.className = 'prompt';
            }
        }

        // Main command processing function
        function processCommand(command) {
            if (waitingForPassword) {
                handlePasswordInput(command);
                return;
            }

            const parts = command.trim().split(/\s+/);
            const cmd = parts[0];
            const args = parts.slice(1);

            // Add command to output
            addToOutput(`${promptElement.textContent} ${command}`, 'command');

            // Process commands
            switch(cmd) {
                case 'ls': executeLs(args); break;
                case 'cd': executeCd(args); break;
                case 'pwd': executePwd(); break;
                case 'mkdir': executeMkdir(args); break;
                case 'rmdir': executeRmdir(args); break;
                case 'touch': executeTouch(args); break;
                case 'rm': executeRm(args); break;
                case 'cp': executeCp(args); break;
                case 'mv': executeMv(args); break;
                case 'cat': executeCat(args); break;
                case 'head': executeHead(args); break;
                case 'tail': executeTail(args); break;
                case 'chmod': executeChmod(args); break;
                case 'chown': executeChown(args); break;
                case 'lsblk': executeLsblk(args); break;
                case 'mount': executeMount(args); break;
                case 'df': executeDf(args); break;
                case 'useradd': executeUseradd(args); break;
                case 'usermod': executeUsermod(args); break;
                case 'userdel': executeUserdel(args); break;
                case 'passwd': executePasswd(args); break;
                case 'id': executeId(args); break;
                case 'whoami': executeWhoami(); break;
                case 'su': executeSu(args); break;
                case 'sudo': executeSudo(args); break;
                case 'exit': executeExit(); break;
                case 'systemctl': executeSystemctl(args); break;
                case 'ps': executePs(args); break;
                case 'grep': executeGrep(args); break;
                case 'find': executeFind(args); break;
                case 'history': executeHistory(); break;
                case 'help': executeHelp(); break;
                case 'clear': clearOutput(); break;
                case '': break;
                default: addToOutput(`bash: ${cmd}: command not found`, 'error');
            }

            // Add to history
            if (command.trim()) {
                commandHistory.push(command);
                historyIndex = commandHistory.length;
            }

            // Scroll to bottom
            output.scrollTop = output.scrollHeight;
        }

        // Handle password input for su/sudo
        function handlePasswordInput(input) {
            if (waitingForPassword) {
                if (input === 'redhat') {
                    addToOutput('', 'response'); // Clear password line
                    if (sudoCommand) {
                        // Execute sudo command
                        addToOutput(`[sudo] password for ${currentUser}: `, 'response');
                        addToOutput('', 'response');
                        processCommand(sudoCommand);
                        sudoCommand = '';
                    } else {
                        // Switch to root
                        isRoot = true;
                        currentUser = 'root';
                        currentDir = '/root';
                        addToOutput('', 'response'); // Clear password line
                        updatePrompt();
                    }
                    waitingForPassword = false;
                } else {
                    addToOutput('', 'response'); // Clear password line
                    addToOutput('su: Authentication failure', 'error');
                    waitingForPassword = false;
                    sudoCommand = '';
                }
            }
        }

        // Command implementations
        function executeLs(args) {
            const path = args[0] ? resolvePath(args[0]) : currentDir;
            const dir = getDirectory(path);
            
            if (!dir || dir.type !== 'directory') {
                addToOutput(`ls: cannot access '${args[0]}': No such file or directory`, 'error');
                return;
            }

            // Check permissions
            if (!hasPermission(dir, 'r')) {
                addToOutput(`ls: cannot open directory '${args[0]}': Permission denied`, 'error');
                return;
            }

            let outputText = '';
            const children = Object.keys(dir.children);
            
            if (args.includes('-l')) {
                // Long listing format
                children.forEach(child => {
                    const childObj = dir.children[child];
                    if (hasPermission(childObj, 'r') || isRoot) {
                        outputText += `${childObj.permissions} ${childObj.owner} ${childObj.group} ${child}\n`;
                    }
                });
            } else {
                // Simple format
                children.forEach(child => {
                    const childObj = dir.children[child];
                    if (hasPermission(childObj, 'r') || isRoot) {
                        const className = childObj.type === 'directory' ? 'directory' : 'file';
                        outputText += `<span class="${className}">${child}</span> `;
                    }
                });
            }
            
            addToOutput(outputText, 'response');
        }

        function executeCd(args) {
            if (!args[0]) {
                currentDir = isRoot ? '/root' : '/home/student';
                updatePrompt();
                return;
            }

            const path = resolvePath(args[0]);
            const dir = getDirectory(path);
            
            if (!dir || dir.type !== 'directory') {
                addToOutput(`cd: ${args[0]}: No such directory`, 'error');
                return;
            }

            // Check permissions
            if (!hasPermission(dir, 'x')) {
                addToOutput(`cd: permission denied: ${args[0]}`, 'error');
                return;
            }

            currentDir = path;
            updatePrompt();
        }

        function executePwd() {
            addToOutput(currentDir, 'response');
        }

        function executeMkdir(args) {
            if (!args[0]) {
                addToOutput('mkdir: missing operand', 'error');
                return;
            }

            // Check if user has write permission in current directory
            const parentDir = getDirectory(currentDir);
            if (!hasPermission(parentDir, 'w') && !isRoot) {
                addToOutput(`mkdir: cannot create directory '${args[0]}': Permission denied`, 'error');
                return;
            }

            const dirName = args[0];

            if (parentDir.children[dirName]) {
                addToOutput(`mkdir: cannot create directory '${dirName}': File exists`, 'error');
                return;
            }

            parentDir.children[dirName] = {
                type: 'directory',
                permissions: 'drwxr-xr-x',
                owner: currentUser,
                group: currentUser,
                children: {}
            };

            addToOutput(`Directory '${dirName}' created`, 'success');
        }

        function executeRmdir(args) {
            if (!args[0]) {
                addToOutput('rmdir: missing operand', 'error');
                return;
            }

            const path = resolvePath(args[0]);
            const dir = getDirectory(path);
            
            if (!dir || dir.type !== 'directory') {
                addToOutput(`rmdir: failed to remove '${args[0]}': No such file or directory`, 'error');
                return;
            }

            // Check permissions
            const parentPath = getParentPath(path);
            const parentDir = getDirectory(parentPath);
            if (!hasPermission(parentDir, 'w') && !isRoot) {
                addToOutput(`rmdir: failed to remove '${args[0]}': Permission denied`, 'error');
                return;
            }

            if (Object.keys(dir.children).length > 0) {
                addToOutput(`rmdir: failed to remove '${args[0]}': Directory not empty`, 'error');
                return;
            }

            const dirName = getPathName(path);
            delete parentDir.children[dirName];
            addToOutput(`Directory '${args[0]}' removed`, 'success');
        }

        function executeTouch(args) {
            if (!args[0]) {
                addToOutput('touch: missing file operand', 'error');
                return;
            }

            // Check if user has write permission in current directory
            const parentDir = getDirectory(currentDir);
            if (!hasPermission(parentDir, 'w') && !isRoot) {
                addToOutput(`touch: cannot touch '${args[0]}': Permission denied`, 'error');
                return;
            }

            const fileName = args[0];

            if (!parentDir.children[fileName]) {
                parentDir.children[fileName] = {
                    type: 'file',
                    permissions: '-rw-r--r--',
                    owner: currentUser,
                    group: currentUser,
                    content: ''
                };
                addToOutput(`File '${fileName}' created`, 'success');
            } else {
                addToOutput(`File '${fileName}' timestamp updated`, 'info');
            }
        }

        function executeRm(args) {
            if (!args[0]) {
                addToOutput('rm: missing operand', 'error');
                return;
            }

            const parentDir = getDirectory(currentDir);
            const fileName = args[0];

            if (!parentDir.children[fileName]) {
                addToOutput(`rm: cannot remove '${fileName}': No such file`, 'error');
                return;
            }

            // Check permissions
            if (!hasPermission(parentDir, 'w') && !isRoot) {
                addToOutput(`rm: cannot remove '${fileName}': Permission denied`, 'error');
                return;
            }

            if (parentDir.children[fileName].type === 'directory' && !args.includes('-r')) {
                addToOutput(`rm: cannot remove '${fileName}': Is a directory`, 'error');
                return;
            }

            delete parentDir.children[fileName];
            addToOutput(`Removed '${fileName}'`, 'success');
        }

        function executeCp(args) {
            if (args.length < 2) {
                addToOutput('cp: missing file operand', 'error');
                return;
            }

            addToOutput(`Copied '${args[0]}' to '${args[1]}'`, 'success');
        }

        function executeMv(args) {
            if (args.length < 2) {
                addToOutput('mv: missing file operand', 'error');
                return;
            }

            addToOutput(`Moved '${args[0]}' to '${args[1]}'`, 'success');
        }

        function executeCat(args) {
            if (!args[0]) {
                addToOutput('cat: missing file operand', 'error');
                return;
            }

            const path = resolvePath(args[0]);
            const file = getDirectory(path);

            if (!file || file.type !== 'file') {
                addToOutput(`cat: ${args[0]}: No such file`, 'error');
                return;
            }

            // Check read permission
            if (!hasPermission(file, 'r') && !isRoot) {
                addToOutput(`cat: ${args[0]}: Permission denied`, 'error');
                return;
            }

            addToOutput(file.content || '(empty file)', 'response');
        }

        function executeHead(args) {
            if (!args[0]) {
                addToOutput('head: missing file operand', 'error');
                return;
            }

            const path = resolvePath(args[0]);
            const file = getDirectory(path);

            if (!file || file.type !== 'file') {
                addToOutput(`head: ${args[0]}: No such file`, 'error');
                return;
            }

            // Check read permission
            if (!hasPermission(file, 'r') && !isRoot) {
                addToOutput(`head: ${args[0]}: Permission denied`, 'error');
                return;
            }

            const lines = file.content.split('\n');
            const n = args.includes('-n') ? parseInt(args[args.indexOf('-n') + 1]) : 10;
            const output = lines.slice(0, n).join('\n');
            addToOutput(output, 'response');
        }

        function executeTail(args) {
            if (!args[0]) {
                addToOutput('tail: missing file operand', 'error');
                return;
            }

            const path = resolvePath(args[0]);
            const file = getDirectory(path);

            if (!file || file.type !== 'file') {
                addToOutput(`tail: ${args[0]}: No such file`, 'error');
                return;
            }

            // Check read permission
            if (!hasPermission(file, 'r') && !isRoot) {
                addToOutput(`tail: ${args[0]}: Permission denied`, 'error');
                return;
            }

            const lines = file.content.split('\n');
            const n = args.includes('-n') ? parseInt(args[args.indexOf('-n') + 1]) : 10;
            const output = lines.slice(-n).join('\n');
            addToOutput(output, 'response');
        }

        function executeChmod(args) {
            if (args.length < 2) {
                addToOutput('chmod: missing operand', 'error');
                return;
            }

            const fileName = args[1];
            const path = resolvePath(fileName);
            const file = getDirectory(path);

            if (!file) {
                addToOutput(`chmod: cannot access '${fileName}': No such file or directory`, 'error');
                return;
            }

            // Only root or file owner can change permissions
            if (file.owner !== currentUser && !isRoot) {
                addToOutput(`chmod: changing permissions of '${fileName}': Operation not permitted`, 'error');
                return;
            }

            addToOutput(`Permissions changed for '${args[1]}' to ${args[0]}`, 'success');
        }

        function executeChown(args) {
            if (args.length < 2) {
                addToOutput('chown: missing operand', 'error');
                return;
            }

            // Only root can change ownership
            if (!isRoot) {
                addToOutput(`chown: changing ownership of '${args[1]}': Operation not permitted`, 'error');
                return;
            }

            addToOutput(`Ownership changed for '${args[1]}' to '${args[0]}'`, 'success');
        }

        function executeLsblk(args) {
            const outputText = `NAME        SIZE TYPE MOUNTPOINT
sda         20G  disk
├─sda1      1G   part /boot
├─sda2      18G  part /
└─sda3      1G   part [SWAP]
sdb         5G   disk
└─sdb1      5G   part /data`;
            addToOutput(outputText, 'response');
        }

        function executeMount(args) {
            const outputText = `/dev/sda2 on / type ext4 (rw,relatime)
/dev/sda1 on /boot type ext4 (rw,relatime)
/dev/sdb1 on /data type ext4 (rw,relatime)`;
            addToOutput(outputText, 'response');
        }

        function executeDf(args) {
            const outputText = `Filesystem     1K-blocks   Used Available Use% Mounted on
/dev/sda2        18874368 5242880  12631488  30% /
/dev/sda1          999320   14392    984928   2% /boot
/dev/sdb1         5242880  123456   5119424   3% /data`;
            addToOutput(outputText, 'response');
        }

        function executeUseradd(args) {
            if (!args[0]) {
                addToOutput('useradd: missing operand', 'error');
                return;
            }
            
            // Only root can add users
            if (!isRoot) {
                addToOutput('useradd: Permission denied.', 'error');
                addToOutput('useradd: cannot lock /etc/passwd; try again later.', 'error');
                return;
            }
            
            addToOutput(`User '${args[0]}' created successfully`, 'success');
        }

        function executeUsermod(args) {
            if (args.length < 3) {
                addToOutput('usermod: missing operand', 'error');
                return;
            }
            
            // Only root can modify users
            if (!isRoot) {
                addToOutput('usermod: Permission denied.', 'error');
                return;
            }
            
            addToOutput(`User '${args[2]}' modified`, 'success');
        }

        function executeUserdel(args) {
            if (!args[0]) {
                addToOutput('userdel: missing operand', 'error');
                return;
            }
            
            // Only root can delete users
            if (!isRoot) {
                addToOutput('userdel: Permission denied.', 'error');
                return;
            }
            
            addToOutput(`User '${args[0]}' deleted`, 'success');
        }

        function executePasswd(args) {
            const username = args[0] || currentUser;
            
            if (username !== currentUser && !isRoot) {
                addToOutput(`passwd: Only root can specify a user name`, 'error');
                return;
            }
            
            addToOutput(`Changing password for user ${username}.`, 'response');
            addToOutput('New password: ', 'response');
            // In a real implementation, you'd handle password change
            addToOutput('Retype new password: ', 'response');
            addToOutput('passwd: all authentication tokens updated successfully.', 'success');
        }

        function executeId(args) {
            const username = args[0] || currentUser;
            let outputText = '';
            
            if (username === 'root' || (isRoot && username === 'root')) {
                outputText = `uid=0(root) gid=0(root) groups=0(root)`;
            } else {
                outputText = `uid=1000(${username}) gid=1000(${username}) groups=1000(${username})`;
            }
            
            addToOutput(outputText, 'response');
        }

        function executeWhoami() {
            addToOutput(currentUser, 'response');
        }

        function executeSu(args) {
            if (isRoot) {
                addToOutput('You are already root!', 'info');
                return;
            }

            const targetUser = args[0] === '-' ? 'root' : (args[0] || 'root');
            
            if (targetUser === 'root') {
                waitingForPassword = true;
                addToOutput('Password: ', 'response');
                // Password input will be handled in handlePasswordInput
            } else {
                addToOutput(`This system doesn't have user '${targetUser}'`, 'error');
            }
        }

        function executeSudo(args) {
            if (isRoot) {
                addToOutput('You are already root! No need for sudo.', 'info');
                return;
            }

            if (args.length === 0) {
                addToOutput('usage: sudo -h | -K | -k | -V\nusage: sudo -v [-AknS] [-g group] [-h host] [-p prompt] [-u user]\nusage: sudo -l [-AknS] [-g group] [-h host] [-p prompt] [-U user] [-u user] [command]\nusage: sudo [-AbEHknPS] [-r role] [-t type] [-C num] [-g group] [-h host] [-p prompt] [-T timeout] [-u user] [VAR=value] [-i|-s] [<command>]\nusage: sudo -e [-AknS] [-r role] [-t type] [-C num] [-g group] [-h host] [-p prompt] [-T timeout] [-u user] file ...', 'response');
                return;
            }

            waitingForPassword = true;
            sudoCommand = args.join(' ');
            addToOutput(`[sudo] password for ${currentUser}: `, 'response');
        }

        function executeExit() {
            if (isRoot) {
                isRoot = false;
                currentUser = 'student';
                currentDir = '/home/student';
                updatePrompt();
                addToOutput('exit', 'response');
            } else {
                addToOutput('exit', 'response');
                addToOutput('Use "su -" to become root first', 'info');
            }
        }

        function executeSystemctl(args) {
            if (args.length < 2) {
                addToOutput('systemctl: missing operand', 'error');
                return;
            }

            const service = args[1];
            
            // Some systemctl commands require root
            const rootCommands = ['start', 'stop', 'restart', 'enable', 'disable'];
            if (rootCommands.includes(args[0]) && !isRoot) {
                addToOutput(`Failed to ${args[0]} ${service}.service: Access denied`, 'error');
                addToOutput('See system logs and \'systemctl status ${service}.service\' for details.', 'info');
                return;
            }

            switch(args[0]) {
                case 'start': addToOutput(`Started ${service} service`, 'success'); break;
                case 'stop': addToOutput(`Stopped ${service} service`, 'success'); break;
                case 'restart': addToOutput(`Restarted ${service} service`, 'success'); break;
                case 'status': addToOutput(`${service}.service - ${isRoot ? 'Active (running)' : 'inactive (dead)'}`, 'response'); break;
                case 'enable': addToOutput(`Enabled ${service} service`, 'success'); break;
                case 'disable': addToOutput(`Disabled ${service} service`, 'success'); break;
                default: addToOutput(`Unknown systemctl command: ${args[0]}`, 'error');
            }
        }

        function executePs(args) {
            const outputText = `PID TTY          TIME CMD
  1 ?        00:00:01 systemd
456 ?        00:00:00 sshd
789 pts/0    00:00:00 bash
901 pts/0    00:00:00 ps`;
            addToOutput(outputText, 'response');
        }

        function executeGrep(args) {
            if (args.length < 2) {
                addToOutput('grep: missing file operand', 'error');
                return;
            }
            
            const pattern = args[0];
            const filename = args[1];
            const path = resolvePath(filename);
            const file = getDirectory(path);
            
            if (!file || file.type !== 'file') {
                addToOutput(`grep: ${filename}: No such file`, 'error');
                return;
            }
            
            // Check read permission
            if (!hasPermission(file, 'r') && !isRoot) {
                addToOutput(`grep: ${filename}: Permission denied`, 'error');
                return;
            }
            
            const lines = file.content.split('\n');
            const matchingLines = lines.filter(line => line.includes(pattern));
            
            if (matchingLines.length === 0) {
                addToOutput('(no matches found)', 'info');
            } else {
                matchingLines.forEach(line => {
                    addToOutput(line, 'response');
                });
            }
        }

        function executeFind(args) {
            if (args.length < 3) {
                addToOutput('find: missing path operand', 'error');
                return;
            }
            addToOutput(`Searching for files matching '${args[2]}' in '${args[0]}'`, 'info');
        }

        function executeHistory() {
            commandHistory.forEach((cmd, index) => {
                addToOutput(` ${index + 1}  ${cmd}`, 'response');
            });
        }

        function executeHelp() {
            const helpText = `Available commands:
Basic: ls, cd, pwd, mkdir, rmdir, touch, rm, cp, mv, cat, head, tail
Permissions: chmod, chown
Storage: lsblk, mount, df
User Management: useradd, usermod, userdel, passwd, id, whoami
Root Access: su, sudo, exit
Services: systemctl
Processes: ps, grep, find
Other: history, help, clear

ROOT ACCESS:
- Use 'su -' and password 'redhat' to become root
- Use 'sudo command' to run commands as root
- Root can access all files and run all commands
- Regular users have limited permissions

TAB COMPLETION:
- Press TAB to complete commands and file names`;
            addToOutput(helpText, 'response');
        }

        // Utility functions
        function addToOutput(text, className) {
            const div = document.createElement('div');
            div.className = className;
            div.innerHTML = text;
            output.appendChild(div);
        }

        function clearOutput() {
            output.innerHTML = '';
            addToOutput('Terminal cleared', 'info');
            addToOutput(`Current directory: <span class="directory">${currentDir}</span>`, 'info');
            if (isRoot) {
                addToOutput('<span class="warning">You are currently root user</span>', 'info');
            }
        }

        function getCurrentDirName() {
            const parts = currentDir.split('/').filter(p => p);
            return parts.length ? parts[parts.length - 1] : '/';
        }

        function resolvePath(path) {
            if (path.startsWith('/')) return path;
            if (path === '..') {
                const parts = currentDir.split('/').filter(p => p);
                parts.pop();
                return '/' + parts.join('/');
            }
            if (path === '.') return currentDir;
            return currentDir === '/' ? `/${path}` : `${currentDir}/${path}`;
        }

        function getDirectory(path) {
            const parts = path.split('/').filter(p => p);
            let current = fileSystem['/'];
            
            for (const part of parts) {
                if (!current.children || !current.children[part]) return null;
                current = current.children[part];
            }
            
            return current;
        }

        function getParentPath(path) {
            const parts = path.split('/').filter(p => p);
            parts.pop();
            return '/' + parts.join('/');
        }

        function getPathName(path) {
            const parts = path.split('/').filter(p => p);
            return parts[parts.length - 1];
        }

        // Check file permissions
        function hasPermission(file, permission) {
            if (isRoot) return true; // Root has all permissions
            
            const perms = file.permissions;
            let checkIndex = 0;
            
            if (file.owner === currentUser) {
                checkIndex = 1; // Owner permissions
            } else {
                checkIndex = 4; // Other permissions
            }
            
            switch(permission) {
                case 'r': return perms[checkIndex] === 'r';
                case 'w': return perms[checkIndex + 1] === 'w';
                case 'x': return perms[checkIndex + 2] === 'x';
                default: return false;
            }
        }

        // Tab completion function
        function getAutocompleteSuggestions(input) {
            const tokens = input.split(' ');
            const currentToken = tokens[tokens.length - 1];
            
            // If we're completing a command (first token)
            if (tokens.length === 1) {
                return allCommands.filter(cmd => cmd.startsWith(currentToken));
            }
            
            // If we're completing a file/directory path
            const pathToComplete = currentToken;
            const basePath = pathToComplete.includes('/') ? 
                pathToComplete.substring(0, pathToComplete.lastIndexOf('/') + 1) : 
                '';
            const partialName = pathToComplete.includes('/') ? 
                pathToComplete.substring(pathToComplete.lastIndexOf('/') + 1) : 
                pathToComplete;
            
            const searchPath = resolvePath(basePath || currentDir);
            const dir = getDirectory(searchPath);
            
            if (!dir) return [];
            
            const children = Object.keys(dir.children);
            const matches = children.filter(child => {
                // Check if user has permission to see this file
                const childObj = dir.children[child];
                return child.startsWith(partialName) && (hasPermission(childObj, 'r') || isRoot);
            });
            
            return matches.map(match => basePath + match);
        }

        // Find common prefix for tab completion
        function findCommonPrefix(strings) {
            if (strings.length === 0) return '';
            
            let prefix = strings[0];
            for (let i = 1; i < strings.length; i++) {
                while (strings[i].indexOf(prefix) !== 0) {
                    prefix = prefix.substring(0, prefix.length - 1);
                    if (prefix === '') return '';
                }
            }
            return prefix;
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Command input
            commandInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    const command = commandInput.value;
                    commandInput.value = '';
                    processCommand(command);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (commandHistory.length > 0 && historyIndex > 0) {
                        historyIndex--;
                        commandInput.value = commandHistory[historyIndex];
                    }
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (historyIndex < commandHistory.length - 1) {
                        historyIndex++;
                        commandInput.value = commandHistory[historyIndex];
                    } else {
                        historyIndex = commandHistory.length;
                        commandInput.value = '';
                    }
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    
                    const suggestions = getAutocompleteSuggestions(commandInput.value);
                    
                    if (suggestions.length === 1) {
                        // Complete with the single suggestion
                        const tokens = commandInput.value.split(' ');
                        tokens[tokens.length - 1] = suggestions[0];
                        commandInput.value = tokens.join(' ') + (suggestions[0].includes('/') ? '' : ' ');
                    } else if (suggestions.length > 1) {
                        // Show suggestions
                        let outputText = '';
                        suggestions.forEach(suggestion => {
                            outputText += `${suggestion}    `;
                        });
                        addToOutput(outputText, 'response');
                        
                        // Find common prefix
                        const commonPrefix = findCommonPrefix(suggestions);
                        if (commonPrefix && commonPrefix.length > commandInput.value.split(' ').pop().length) {
                            const tokens = commandInput.value.split(' ');
                            tokens[tokens.length - 1] = commonPrefix;
                            commandInput.value = tokens.join(' ');
                        }
                    }
                }
            });

            // Clear button
            document.getElementById('clear-btn').addEventListener('click', clearOutput);

            // Help button
            document.getElementById('help-btn').addEventListener('click', executeHelp);

            // Reset button
            document.getElementById('reset-btn').addEventListener('click', function() {
                location.reload();
            });

            // Scenario items
            scenarioItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all items
                    scenarioItems.forEach(i => i.classList.remove('active'));
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    const scenario = this.getAttribute('data-scenario');
                    let info = '';
                    
                    switch(scenario) {
                        case 'files': info = 'File Management: Practice ls, cd, mkdir, rmdir, touch, rm, cp, mv'; break;
                        case 'perms': info = 'Permissions: Practice chmod, chown, ls -l (root required for some)'; break;
                        case 'users': info = 'User Management: Practice useradd, usermod, passwd (root required)'; break;
                        case 'storage': info = 'Storage: Practice lsblk, mount, df, fdisk'; break;
                        case 'services': info = 'Services: Practice systemctl (root required for start/stop)'; break;
                        case 'processes': info = 'Processes: Practice ps, grep, find, kill'; break;
                        case 'root': info = 'Root Access: Practice su, sudo, root commands. Password: redhat'; break;
                    }
                    
                    addToOutput(`<span class="info">Active scenario: ${info}</span>`, 'response');
                    if (scenario === 'root') {
                        addToOutput(`<span class="warning">Use 'su -' and password 'redhat' to become root</span>`, 'response');
                    }
                });
            });

            // Focus on input
            commandInput.focus();
        });
    </script>
</body>
</html>
